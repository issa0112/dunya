{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ produit.nom }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    {% comment %} <link rel="stylesheet" href="{% static 'stylevid.css' %}">
    <link rel="stylesheet" href="{% static 'style1.css' %}"> {% endcomment %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>

        body { font-family: "Times New Roman", Times, serif; background: #f9f9f9; margin: 0; padding: 0; }

        .product-container { display: flex; flex-wrap: wrap; gap: 30px; margin: 40px; }
        .product-gallery { width: 50%; min-width: 300px; }
        .product-info { width: 45%; min-width: 300px; }

        .btn-reserve { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn-reserve:disabled { background: gray; cursor: not-allowed; }

        /* Swiper */
        .swiper { border-radius: 10px; }
        .swiper-slide img { width: 100%; border-radius: 10px; }
        .swiper-thumbs { margin-top: 15px; }
        .swiper-thumbs .swiper-slide { width: 80px; height: 80px; opacity: 0.5; cursor: pointer; }
        .swiper-thumbs .swiper-slide-thumb-active { opacity: 1; border: 2px solid #28a745; border-radius: 6px; }
        .swiper-thumbs img { width: 100%; height: 100%; object-fit: contain; border-radius: 6px; }

        /* Zoom */
        .zoom-container { position: relative; overflow: hidden; cursor: zoom-in; border-radius: 10px; }
        .zoom-container img { transition: transform 0.4s ease; width: 100%; height: auto; }

        /* Lightbox */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }
        .lightbox img {
            max-height: 90vh;
            max-width: 90vw;
            object-fit: contain;
            border-radius: 10px;
        }
        .lightbox-close {
            position: absolute;
            top: 20px; right: 30px;
            font-size: 40px;
            color: white;
            cursor: pointer;
            z-index: 10000;
        }
        .lightbox .swiper-button-next,
        .lightbox .swiper-button-prev {
            color: white;
        }

        /* Produits similaires */
        .related-products {     
            margin: 60px auto;
            max-width: 1200px;
            
}
        .related-products h2 { margin-bottom: 20px; }
        .related-products .swiper-slide {
                background: white;
                border: 1px solid #ddd;
                border-radius: 10px;
                margin-top:20px;
                margin-bottom:50px;
                margin-top:20px;
                padding: 10px;
                text-align: center;
                transition: transform 0.2s ease;
                height: 330px;           /* Hauteur fixe */
                display: flex;
                flex-direction: column;
                justify-content: space-between;
        }
        .related-products .swiper-slide:hover {
            transform: translateY(-5px);
            border-left: 1px solid rgb(71, 145, 139);
            border-top: 1px solid rgb(71, 145, 139);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
                /* backdrop-filter: blur(10px); */
            box-shadow: 20px 20px 20px -6px rgb(71, 145, 139);
        }
        .related-products img {
                width: 100%;
                height: 200px;          /* Taille uniforme */
                object-fit: contain;    /* image entière sans déformation */
                border-radius: 8px;
                margin-bottom: 10px;
                
        }
        .related-products .swiper-slide h5 {
            font-size: 14px;
            margin: 5px 0;
            white-space: nowrap;       /* pas de retour à la ligne */
            overflow: hidden;          /* cache le surplus */
            text-decoration:none;
        }

        .related-products .swiper-slide p {
            font-size: 18px;
            font-weight: bold;
            color: green;
            margin: 0;
        }

        a {
            text-decoration: none;
            color: inherit;
        }
        h1, h4 {
            color:blue;
        }

    </style>
</head>
<body>
<nav class="navbar">
    <!-- Logo -->
    <div class="logo-container">
        <img src="{% static 'images/logodounya.png' %}" alt="Logo APK" class="logo">
    </div>

    <!-- Menu principal -->
    <ul class="nav-menu">
        <li><a href="{% url 'liste_produits' %}"><i class="bi bi-box-seam"></i> Produit</a></li>
        <li><a href="{% url 'services' %}"><i class="bi bi-info-circle"></i> Service</a></li>
        <!-- <li><a href="#"><i class="bi bi-envelope"></i> Contactez-nous</a></li> -->
    </ul>

    <!-- Zone utilisateur -->
    <div class="user">
        {% if user.is_authenticated %}
            <p class="nameuser">
                <span class="username">Bonjour {{ user.username }}</span>
                <a href="{% url 'deconnexion' %}" class="btn btn-deconnexion">
                    <i class="bi bi-box-arrow-left"></i> Déconnexion
                </a>
            </p>
        {% else %}
            <a href="{% url 'connexion' %}" class="btn btn-connexion">
                <i class="bi bi-box-arrow-in-right"></i> Connexion
            </a>
            <a href="{% url 'inscription' %}" class="btn btn-inscription">
                <i class="bi bi-person-badge"></i> S'inscrire
            </a>
        {% endif %}

        <!-- Panier -->
        <a href="{% url 'panier' %}" class="cart-icon">
            <i class="bi bi-cart4"></i>
            {% if panier_count %}
                <span class="cart-count">{{ panier_count }}</span>
            {% endif %}
        </a>

    </div>

    <!-- Bouton hamburger pour mobile -->
    <div class="menu-toggle">
        <i class="bi bi-list"></i>
    </div>
</nav>


<div class="product-container">

    <!-- Galerie avec Swiper -->
    <div class="product-gallery">
        <!-- Swiper principal -->
        <div class="swiper mySwiper2">
            <div class="swiper-wrapper">
                {% if produit.image %}
                    <div class="swiper-slide">
                        <div class="zoom-container">
                            <img src="{{ produit.image.url }}" alt="{{ produit.nom }}">
                        </div>
                    </div>
                {% endif %}
                {% for img in images %}
                    <div class="swiper-slide">
                        <div class="zoom-container">
                            <img src="{{ img.image.url }}" alt="{{ produit.nom }}">
                        </div>
                    </div>
                {% endfor %}
            </div>
            <!-- Flèches -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>

        <!-- Miniatures -->
        <div class="swiper mySwiper swiper-thumbs">
            <div class="swiper-wrapper">
                {% if produit.image %}
                    <div class="swiper-slide"><img src="{{ produit.image.url }}"></div>
                {% endif %}
                {% for img in images %}
                    <div class="swiper-slide"><img src="{{ img.image.url }}"></div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Infos produit -->
    <div class="product-info">
        <h1>{{ produit.nom }}</h1>
        <h3 style="color:green;">{{ produit.prix }} FCFA</h3>
        <p>{{ produit.description }}</p>

        <p><strong>Catégorie :</strong> {{ produit.categorie.nom }}</p>
        {% if produit.date_expiration %}
            <p><strong>Date d’expiration :</strong> {{ produit.date_expiration|date:"d/m/Y" }}</p>
        {% endif %}

        {% if produit.quantite > 0 and produit.disponible %}
                    <a href="{% url 'ajouter_panier' produit.id %}" class="btn-reserve">
                        <i class="bi bi-cart-plus"></i> Ajouter au panier
                    </a>
        {% else %}
            <button class="btn-reserve" disabled>
                <i class="bi bi-cart-x"></i> Indisponible
            </button>
        {% endif %}
    </div>
</div>

<!-- Produits similaires -->
<div class="related-products">
    <h2>Produits similaires</h2>
    <div class="swiper related-swiper">
        <div class="swiper-wrapper">
            {% for p in produits_similaires %}
            <div class="swiper-slide">
                <a href="{% url 'detail_produit' p.id %}">
                    <img src="{{ p.image.url }}" alt="{{ p.nom }}">
                    <h4>{{ p.nom }}</h4>
                    <p style="color:green;">{{ p.prix }} FCFA</p>
                </a>
            </div>
            {% endfor %}
        </div>
        <!-- Flèches -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox">
    <div class="swiper lightbox-swiper">
        <div class="swiper-wrapper">
            {% if produit.image %}
                <div class="swiper-slide"><img src="{{ produit.image.url }}" alt="{{ produit.nom }}"></div>
            {% endif %}
            {% for img in images %}
                <div class="swiper-slide"><img src="{{ img.image.url }}" alt="{{ produit.nom }}"></div>
            {% endfor %}
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <span class="lightbox-close">&times;</span>
    </div>
</div>

<footer class="footer">
    
    <div class="social-icons">
        <a href="https://www.facebook.com" target="_blank" class="icon facebook">
            <i class="bi bi-facebook"></i>
        </a>
        <a href="https://www.tiktok.com" target="_blank" class="icon tiktok">
            <i class="bi bi-tiktok"></i>
        </a>
        <a href="https://twitter.com" target="_blank" class="icon twitter">
            <i class="bi bi-twitter"></i>
        </a>
    </div>
    <p>&copy; 2025 Dounya. Tous droits réservés.</p>
</footer>


<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
    // Miniatures + Galerie
    var swiper = new Swiper(".mySwiper", {
        loop: true,
        spaceBetween: 10,
        slidesPerView: 4,
        freeMode: true,
        watchSlidesProgress: true,
    });

    var swiper2 = new Swiper(".mySwiper2", {
        loop: true,
        spaceBetween: 10,
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
        thumbs: { swiper: swiper },
    });

    // Produits similaires
    var relatedSwiper = new Swiper(".related-swiper", {
        slidesPerView: 4,
        spaceBetween: 20,
        navigation: { nextEl: ".related-products .swiper-button-next", prevEl: ".related-products .swiper-button-prev" },
        breakpoints: {
            0: { slidesPerView: 1 },
            576: { slidesPerView: 2 },
            768: { slidesPerView: 3 },
            992: { slidesPerView: 4 }
        }
    });

    // Zoom Desktop (hover)
    document.querySelectorAll('.zoom-container').forEach(container => {
        const img = container.querySelector('img');
        if (window.innerWidth > 768) {
            container.addEventListener('mousemove', e => {
                const rect = container.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                img.style.transformOrigin = `${x}% ${y}%`;
                img.style.transform = "scale(1.8)";
            });
            container.addEventListener('mouseleave', () => {
                img.style.transformOrigin = "center center";
                img.style.transform = "scale(1)";
            });
        }
    });

    // Zoom Mobile (double tap)
    document.querySelectorAll('.zoom-container').forEach(container => {
        const img = container.querySelector('img');
        let lastTap = 0;
        let zoomed = false;
        container.addEventListener('touchend', e => {
            let currentTime = new Date().getTime();
            let tapLength = currentTime - lastTap;
            if (tapLength < 300 && tapLength > 0) {
                if (!zoomed) {
                    img.style.transformOrigin = "center center";
                    img.style.transform = "scale(2)";
                    zoomed = true;
                } else {
                    img.style.transform = "scale(1)";
                    zoomed = false;
                }
            }
            lastTap = currentTime;
        });
    });

    // Lightbox
    var lightboxSwiper = new Swiper(".lightbox-swiper", {
        loop: true,
        navigation: { nextEl: ".lightbox .swiper-button-next", prevEl: ".lightbox .swiper-button-prev" },
    });

    document.querySelectorAll('.zoom-container img').forEach((img, index) => {
        img.addEventListener('click', () => {
            document.getElementById("lightbox").style.display = "flex";
            lightboxSwiper.slideToLoop(index);
        });
    });

    document.querySelector(".lightbox-close").addEventListener("click", () => {
        document.getElementById("lightbox").style.display = "none";
    });

    document.addEventListener("keydown", e => {
        if (e.key === "Escape") {
            document.getElementById("lightbox").style.display = "none";
        }
    });


 
    const toggle = document.querySelector(".menu-toggle");
    const menu = document.querySelector(".nav-menu");

    toggle.addEventListener("click", () => {
        menu.classList.toggle("active");
    });


</script>
</body>
</html>
