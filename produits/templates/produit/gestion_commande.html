{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion des commandes</title>
    <link rel="stylesheet" href="{% static 'bootstrap.min.css' %}">
</head>
<body class="container py-4">

    <h2>ðŸ“¦ Gestion des commandes</h2>

    {% if commandes %}
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Date</th>
                    <th>Client</th>
                    <th>Total</th>
                    <th>Paiement</th>
                    <th>Statut</th>
                    <th>DÃ©tails</th>
                </tr>
            </thead>
            <tbody>
                {% for commande in commandes %}
                    <tr>
                        <td>#{{ commande.id }}</td>
                        <td>{{ commande.date|date:"d/m/Y H:i" }}</td>
                        <td>{{ commande.nom }} {{ commande.prenom }}</td>
                        <td>{{ commande.total }} FCFA</td>
                        <td>{{ commande.mode_paiement }}</td>
                        <td>
                            <form method="post" action="{% url 'changer_statut_commande' commande.id %}">
                                {% csrf_token %}
                                <select name="statut" class="form-select form-select-sm" onchange="this.form.submit()">
                                    {% for value,label in commande._meta.get_field('statut').choices %}
                                        <option value="{{ value }}" {% if commande.statut == value %}selected{% endif %}>
                                            {{ label }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </form>
                        </td>
                        <td>
                            <button class="btn btn-info btn-sm" data-bs-toggle="collapse" data-bs-target="#details{{ commande.id }}">
                                Voir
                            </button>
                        </td>
                    </tr>
                    <tr id="details{{ commande.id }}" class="collapse">
                        <td colspan="7">
                            <ul>
                                {% for ligne in commande.lignes.all %}
                                    <li>{{ ligne.quantite }} Ã— {{ ligne.produit.nom }} â€” {{ ligne.sous_total }} FCFA</li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Aucune commande enregistrÃ©e.</p>
    {% endif %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
